<nav class="navbar header bg-primary">
  <div class="container-fluid">
    <div>
      <button class="btn btn-danger" (click)="logOut()">Déconnexion</button>
      <button class="btn btn-light" (click)="openProjectCreationModal()">
        Créer un projet
      </button>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <h1 class="mb-4">Mes Projets</h1>

  <!-- Chargement -->
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Tableau des projets -->
  <div *ngIf="!loading && projects.length > 0" class="table-responsive">
    <table class="table table-striped table-hover align-middle rounded-table">
      <thead class="table-dark">
        <tr>
          <th class="column-title">Nom du Projet</th>
          <th class="description-title">Description</th>
          <th class="text-center column-title">Date de Début</th>
          <th class="text-center column-title">Votre Rôle</th>
          <th class="text-center column-title">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of projects">
          <td
            class="text-truncate fw-semibold"
            style="max-width: 150px"
            [title]="project.name"
          >
            {{ project.name }}
          </td>
          <td
            class="text-truncate"
            style="max-width: 200px"
            [title]="project.description || ''"
          >
            {{ project.description || "-" }}
          </td>
          <td class="text-center">
            {{ project.startDate | date : "dd/MM/yyyy" }}
          </td>
          <td class="text-center">
            <span
              class="badge"
              [ngStyle]="{
                'background-color': getUserRoleLabel(project).color
              }"
            >
              {{ getUserRoleLabel(project).label }}
            </span>
          </td>
          <td>
            <div class="d-flex gap-2 justify-content-center">
              <button
                class="btn btn-sm btn-primary rounded-pill"
                [routerLink]="['/project', project.id]"
                title="Voir la tâche"
              >
                Voir
              </button>
              <button
                class="btn btn-sm btn-danger rounded-pill"
                (click)="deleteProject(project.id)"
                title="Supprimer le projet"
              >
                Supprimer
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty screen projet -->
  <div
    *ngIf="!loading && projects.length === 0"
    class="alert alert-info d-flex flex-column align-items-center"
  >
    <div>
      <strong>Aucun projet</strong> - Vous n'avez aucun projet pour le moment.
    </div>
    <button class="btn btn-primary mt-2" (click)="openProjectCreationModal()">
      Créer un projet
    </button>
  </div>
</div>

<app-project-modal
  [isOpen]="isModalOpen"
  (closed)="closeProjectCreationModal()"
  (saved)="onProjectSaved($event)"
></app-project-modal>
